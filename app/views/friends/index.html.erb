<%# <h1>All Users</h1> %>
<%# <ul> %>
  <%# @users.each do |user| %>
    <%# <li> %>
      <%#= link_to user.email, friend_path(user) %>
      <%# Optional: follow/unfollow button here %>
    <%# </li> %>
  <%# end %>
<%# </ul> %>

<% @users.each do |user| %>
  <p><%= link_to user.email, friend_path(user) %></p>
  <% if current_user.friends.include?(user) %>
    <p>Already friends</p>
    <%= button_to "Unfriend", unfriend_path(user), method: :delete if current_user.friends.include?(user) %>

  <% elsif current_user.sent_friend_requests.exists?(receiver_id: user.id, status: 'pending') %>
    <p>Request sent</p>
  <% elsif current_user.received_friend_requests.exists?(sender_id: user.id, status: 'pending') %>
    <%= button_to "Accept Request", friend_request_path(current_user.received_friend_requests.find_by(sender_id: user.id)), method: :put %>
    <%= button_to "Reject", friend_request_path(current_user.received_friend_requests.find_by(sender_id: user.id)), method: :delete %>
  <% else %>
    <%= button_to "Send Friend Request", friend_requests_path(receiver_id: user.id), method: :post %>
  <% end %>
<% end %>
